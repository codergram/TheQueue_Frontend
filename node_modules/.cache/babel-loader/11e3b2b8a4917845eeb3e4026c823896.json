{"ast":null,"code":"import _objectSpread from\"/var/www/html/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{SERVER_URL}from\"./settings\";import{SERVER_URL_BACKEND}from\"./settingsBackend\";function handleHttpErrors(res){if(!res.ok){//console.log(res);\nif(res.status===401){document.getElementById(\"errorMsg\").innerHTML=\"Email blev ikke varificeret...\";document.getElementById(\"errorMsg\").style.display=\"block\";setInterval(function(){document.getElementById(\"errorMsg\").innerHTML=\"\";document.getElementById(\"errorMsg\").style.display=\"none\";},2500);}//   const message = res.statusText === \"\" ? \"Something went wrong... :(\" : \"\";\n//   document.getElementById(\"errorMsg\").innerHTML =\n//     \"Status code: \" + res.status + \", message: \" + message;\nreturn Promise.reject({status:res.status,fullError:res.json()});}return res.json();}function apiUtils(){function makeOptions(method,addToken,body){// console.log(method);\nmethod=method?method:\"GET\";var opts={method:method,headers:_objectSpread(_objectSpread({},[\"PUT\",\"POST\"].includes(method)&&{//using spread operator to conditionally add member to headers object.\n\"Content-type\":\"application/json\"}),{},{Accept:\"application/json\"})};// console.log(method);\nif(addToken&&loggedIn()){opts.headers[\"x-access-token\"]=getToken();}if(body){opts.body=JSON.stringify(body);}return opts;}function fetchAny(url,callback,method,body){// console.log(url);\n//console.log(callback);\n// console.log(method);\n//console.log(body);\nvar options=makeOptions(method,true,body);//console.log(options);\nfetch(url,options).then(function(res){return handleHttpErrors(res);}).then(function(data){return callback(data);}).catch(function(err){if(err.status){err.fullError.then(function(e){return console.log(e.detail);});}else{console.log(\"Network error\");}});}function login(user,password){//console.log(user);\n//console.log(password);\n/*TODO*/var options=makeOptions(\"POST\",true,{// user: user,\nemail:user,password:password});return fetch(SERVER_URL_BACKEND+\"/api/auth/\",options).then(handleHttpErrors).then(function(res){// console.log(res);\n// document.getElementById(\"error\").innerHTML = \"\";\nsetToken(res.token);saveEmail(user);});}function fetchWelcomeData(){/*TODO */var options=makeOptions(\"GET\",true);//True add's the token\nreturn fetch(SERVER_URL+\"/api/info/admin\",options).then(handleHttpErrors);}var setToken=function setToken(token){localStorage.setItem(\"jwtToken\",token);};var saveEmail=function saveEmail(email){localStorage.setItem(\"teacherEmail\",email);};var getToken=function getToken(){return localStorage.getItem(\"jwtToken\");};var loggedIn=function loggedIn(){var loggedIn=getToken()!=null;return loggedIn;};var logout=function logout(){localStorage.removeItem(\"jwtToken\");localStorage.removeItem(\"teacherEmail\");};return{makeOptions:makeOptions,fetchAny:fetchAny,// fetchAnyNoToken,\nlogin:login,fetchWelcomeData:fetchWelcomeData,setToken:setToken,getToken:getToken,loggedIn:loggedIn,logout:logout};}var utils=apiUtils();export default utils;//   export default { fetchAny, login, fetchWelcomeData, makeOptions };","map":{"version":3,"names":["SERVER_URL","SERVER_URL_BACKEND","handleHttpErrors","res","ok","status","document","getElementById","innerHTML","style","display","setInterval","Promise","reject","fullError","json","apiUtils","makeOptions","method","addToken","body","opts","headers","includes","Accept","loggedIn","getToken","JSON","stringify","fetchAny","url","callback","options","fetch","then","data","catch","err","e","console","log","detail","login","user","password","email","setToken","token","saveEmail","fetchWelcomeData","localStorage","setItem","getItem","logout","removeItem","utils"],"sources":["/var/www/html/src/utils.js"],"sourcesContent":["import { SERVER_URL } from \"./settings\";\nimport { SERVER_URL_BACKEND } from \"./settingsBackend\";\n\nfunction handleHttpErrors(res) {\n  if (!res.ok) {\n    //console.log(res);\n    if (res.status === 401) {\n      document.getElementById(\"errorMsg\").innerHTML =\n        \"Email blev ikke varificeret...\";\n      document.getElementById(\"errorMsg\").style.display = \"block\";\n      setInterval(function () {\n        document.getElementById(\"errorMsg\").innerHTML =\n        \"\";\n      document.getElementById(\"errorMsg\").style.display = \"none\";\n      }, 2500);\n    }\n    //   const message = res.statusText === \"\" ? \"Something went wrong... :(\" : \"\";\n    //   document.getElementById(\"errorMsg\").innerHTML =\n    //     \"Status code: \" + res.status + \", message: \" + message;\n\n    return Promise.reject({ status: res.status, fullError: res.json() });\n  }\n  return res.json();\n}\n\nfunction apiUtils() {\n  function makeOptions(method, addToken, body) {\n    // console.log(method);\n    method = method ? method : \"GET\";\n    var opts = {\n      method: method,\n      headers: {\n        ...([\"PUT\", \"POST\"].includes(method) && {\n          //using spread operator to conditionally add member to headers object.\n          \"Content-type\": \"application/json\",\n        }),\n        Accept: \"application/json\",\n      },\n    };\n    // console.log(method);\n    if (addToken && loggedIn()) {\n      opts.headers[\"x-access-token\"] = getToken();\n    }\n    if (body) {\n      opts.body = JSON.stringify(body);\n    }\n    return opts;\n  }\n\n  function fetchAny(url, callback, method, body) {\n    // console.log(url);\n    //console.log(callback);\n    // console.log(method);\n    //console.log(body);\n    const options = makeOptions(method, true, body);\n    //console.log(options);\n    fetch(url, options)\n      .then((res) => handleHttpErrors(res))\n      .then((data) => callback(data))\n      .catch((err) => {\n        if (err.status) {\n          err.fullError.then((e) => console.log(e.detail));\n        } else {\n          console.log(\"Network error\");\n        }\n      });\n  }\n\n  function login(user, password) {\n    //console.log(user);\n    //console.log(password);\n    /*TODO*/\n    const options = makeOptions(\"POST\", true, {\n      // user: user,\n      email: user,\n      password: password,\n    });\n\n    return fetch(SERVER_URL_BACKEND + \"/api/auth/\", options)\n      .then(handleHttpErrors)\n      .then((res) => {\n        // console.log(res);\n        // document.getElementById(\"error\").innerHTML = \"\";\n        setToken(res.token);\n        saveEmail(user);\n      });\n  }\n\n  function fetchWelcomeData() {\n    /*TODO */\n    const options = makeOptions(\"GET\", true); //True add's the token\n    return fetch(SERVER_URL + \"/api/info/admin\", options).then(\n      handleHttpErrors\n    );\n  }\n\n  const setToken = (token) => {\n    localStorage.setItem(\"jwtToken\", token);\n  };\n\n  const saveEmail = (email) => {\n    localStorage.setItem(\"teacherEmail\", email);\n  };\n\n  const getToken = () => {\n    return localStorage.getItem(\"jwtToken\");\n  };\n\n  const loggedIn = () => {\n    const loggedIn = getToken() != null;\n    return loggedIn;\n  };\n\n  const logout = () => {\n    localStorage.removeItem(\"jwtToken\");\n    localStorage.removeItem(\"teacherEmail\");\n  };\n\n  return {\n    makeOptions,\n    fetchAny,\n    // fetchAnyNoToken,\n    login,\n    fetchWelcomeData,\n    setToken,\n    getToken,\n    loggedIn,\n    logout,\n  };\n}\n\nconst utils = apiUtils();\nexport default utils;\n\n//   export default { fetchAny, login, fetchWelcomeData, makeOptions };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}